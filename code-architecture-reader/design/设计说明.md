# `code-architecture-reader` 技能设计说明

## 1. 目标

创建一个通用 Codex skill，用于在辅助阅读工程代码时，稳定输出：

1. 架构与模块边界说明
2. 关键调用链/数据流分析
3. 设计优点与缺点（带证据）
4. 分优先级的改进建议

该技能面向“理解代码架构与设计取舍”的任务，而不是功能实现或 bug 修复。

## 2. 用户确认约束（已固化）

- 技能名称：`code-architecture-reader`
- 定位：通用技能（不是项目专用）
- 输出语言：中文
- 术语风格：专业名词首次出现附英文注释
- 输出风格：深度版（包含改进建议与不确定项）

## 3. 设计原则

### 3.1 强证据导向

要求在结论中引用代码位置（文件+行号），减少空泛描述和误判。

### 3.2 先结构后评价

先建立项目地图 (Project Map) 与架构视图，再讨论优缺点，避免“只看单点代码就下架构结论”。

### 3.3 区分事实与推断

对静态阅读无法确认的运行时行为做显式标注，降低误导风险。

### 3.4 深度版默认输出

默认提供完整结构（总览、关键链路、优缺点、建议、未知项），避免每次重复说明分析格式。

## 4. 内容结构设计

### 4.1 `SKILL.md`

职责：

- 定义触发场景（通过 frontmatter description）
- 定义执行流程与质量标准
- 定义输出格式约束
- 引导按需读取参考文件

### 4.2 `references/report-template.md`

职责：

- 提供深度版架构分析报告模板
- 统一“优点/风险/建议”的表达结构
- 提高不同项目间输出的一致性

### 4.3 `references/analysis-checklist.md`

职责：

- 在执行前/输出前做遗漏检查
- 提醒证据完整性、风险分析质量、建议可执行性

### 4.4 `design/设计说明.md`

职责：

- 保存本次技能设计决策，便于你后续入个人 Git 仓库归档和迁移
- 不作为运行时参考文件使用

## 5. 关键取舍（Trade-offs）

1. 选择“通用技能”而非“项目专用模板”
   - 优点：可复用于不同语言、不同框架项目
   - 代价：不能内置项目特定目录约定和领域知识

2. 默认“深度版”而非“简洁版”
   - 优点：结果更稳定完整，更适合架构讨论和重构前评估
   - 代价：输出成本更高，面对小项目时可能偏重（可临时裁剪）

3. 不内置脚本
   - 优点：初版简单、可迁移性高
   - 代价：目录扫描/调用链整理依赖临场命令与人工归纳

## 6. 后续迭代建议（可选）

1. 增加 `references/language-specific/`（如 Java、Go、Python、TypeScript 的入口识别与常见架构模式）
2. 增加 `scripts/project_map.*` 用于自动生成目录摘要与依赖线索
3. 增加 `references/smell-catalog.md`（常见架构异味 Architecture Smells）
4. 增加 `references/diagram-prompts.md`（用于生成架构图的提示模板）

## 7. 安装与迁移说明（供后续使用）

当前目录中的 `code-architecture-reader/` 已按技能目录结构组织。后续可将该目录提交到你的个人 Git 仓库，然后在其他主机上复制到 Codex skills 路径（例如 `$CODEX_HOME/skills/...`）中使用。
